{% extends "layout.html" %}{% block content %}
<div class="card result-card">
  <div class="header-row">
    <div>
      <h2>{{ ticker }} ‚Äî Prediction</h2>
      <p class="muted">Previous Close: <strong>${{ prev_close }}</strong></p>
      <p><strong>Predicted Next-Day Price:</strong> ${{ "%.2f"|format(pred_price|float) }}</p>
      <p class="muted">Adjustment reason: {{ adj_reason }}</p>

    </div>
    <div class="recommendation {{ rec_class }}">
      <strong>{{ recommendation }}</strong>
      <div class="rec-reason">{{ rec_reason }}</div>
    </div>
  </div>

  <h3>Model Metrics</h3>
  <table>
    <thead><tr><th>Model</th><th>MAE</th><th>R¬≤</th></tr></thead>
    <tbody>
      <tr><td>LGBM</td><td>{{ metrics.lgbm_mae or '‚Äî' }}</td><td>{{ metrics.lgbm_r2 or '‚Äî' }}</td></tr>
      <tr><td>Hybrid</td><td>{{ metrics.hybrid_mae or '‚Äî' }}</td><td>{{ metrics.hybrid_r2 or '‚Äî' }}</td></tr>
    </tbody>
  </table>

  {% if plot_url %}
    <h3>Prediction Chart</h3>
    <img src="{{ plot_url }}?t={{ ts }}" alt="chart"/>
  {% endif %}

  <h3>Top 10 Textual Signals</h3>
  {% if top10 %}
  <table class="wide">
    <thead><tr><th>Source</th><th>Date</th><th>Pos</th><th>Neu</th><th>Neg</th><th>Text</th></tr></thead>
    <tbody>
      {% for row in top10 %}
        <tr><td>{{ row.source }}</td><td>{{ row.date }}</td><td>{{ row.pos }}</td><td>{{ row.neu }}</td><td>{{ row.neg }}</td><td>{{ row.text }}</td></tr>
      {% endfor %}
    </tbody>
  </table>
  {% else %}
  <p class="muted">No textual data found.</p>
  {% endif %}

  <h3>Gemini Summary</h3>
  <div class="gemini-box">{{ gemini or 'Gemini summary unavailable (demo mode).' }}</div>

    {% if event_table %}
  <h3>üìÖ Event Days & Related Textual Data</h3>
  <table class="wide">
    <thead>
      <tr>
        <th>Date</th>
        <th>Event Type</th>
        <th>Source</th>
        <th>Title</th>
        
      </tr>
    </thead>
    <tbody>
      {% for e in event_table %}
        <tr>
          <td>{{ e.date }}</td>
          <td>{{ e.event_type }}</td>
          <td>{{ e.source }}</td>
          <td>{{ e.title }}</td>
          
        </tr>
      {% endfor %}
    </tbody>
  </table>
  {% else %}
  <p class="muted">No event-day textual data available.</p>
  {% endif %}


  <a href="/" class="back">‚Üê Back</a>
</div>
{% endblock %}